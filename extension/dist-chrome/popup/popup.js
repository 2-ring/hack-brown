var f=globalThis.chrome,Ve=typeof browser<"u",s=Ve?browser:f,ne=typeof f<"u"&&"sidePanel"in f,se=typeof browser<"u"&&"sidebarAction"in browser,oe=typeof f<"u"&&typeof f.storage<"u"&&"session"in f.storage,A=typeof f<"u"&&"notifications"in f,Ue=typeof f<"u"&&typeof f.action?.openPopup=="function",$e=typeof f<"u"&&"alarms"in f;var y="__session:";function ie(e){return typeof e=="string"?[`${y}${e}`]:Array.isArray(e)?e.map(t=>`${y}${t}`):Object.keys(e).map(t=>`${y}${t}`)}function ae(e){let t={};for(let[n,o]of Object.entries(e))t[`${y}${n}`]=o;return t}function Ge(e){let t={};for(let[n,o]of Object.entries(e))n.startsWith(y)&&(t[n.slice(y.length)]=o);return t}var N=new Set,re=!1;function ze(){re||(re=!0,s.storage.local.onChanged.addListener(e=>{if(N.size===0)return;let t={},n=!1;for(let[o,a]of Object.entries(e))o.startsWith(y)&&(t[o.slice(y.length)]=a,n=!0);if(n)for(let o of N)o(t,"session")}))}var Ke={get(e,t){let n=e===null?null:ie(e);s.storage.local.get(n,o=>{t(Ge(o))})},set(e,t){t?s.storage.local.set(ae(e),t):s.storage.local.set(ae(e))},remove(e,t){let n=ie(e);t?s.storage.local.remove(n,t):s.storage.local.remove(n)},clear(e){s.storage.local.get(null,t=>{let n=Object.keys(t).filter(o=>o.startsWith(y));n.length>0?e?s.storage.local.remove(n,e):s.storage.local.remove(n):e?.()})},onChanged:{addListener(e){ze(),N.add(e)}}};function je(){let e=s.storage.session;return{get(t,n){e.get(t,n)},set(t,n){n?e.set(t,n):e.set(t)},remove(t,n){n?e.remove(t,n):e.remove(t)},clear(t){t?e.clear(t):e.clear()},onChanged:e.onChanged}}var u={local:s.storage.local,session:oe?je():Ke,onChanged:s.storage.onChanged};var Qe={create(e,t){A&&s.notifications.create(e,t)},onClicked:A?s.notifications.onClicked:{addListener:e=>{}}};function We(){return{isSupported:!0,async open({windowId:e,sessionId:t}){t&&await new Promise(n=>{u.session.set({sidebarSessionId:t},n)}),e&&await s.sidePanel.open({windowId:e})}}}function Ze(){return{isSupported:!0,async open({sessionId:e}){e&&await new Promise(t=>{u.session.set({sidebarSessionId:e},t)}),await s.sidebarAction.open()}}}function Xe(){return{isSupported:!0,async open({sessionId:e}){let t=e?`?session=${e}`:"",n=s.runtime.getURL(`sidebar/sidebar.html${t}`);await s.windows.create({url:n,type:"popup",width:380,height:600})}}}var Y=ne?We():se?Ze():Xe();var At=1/30;var k="themeMode";function de(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function _(e){document.documentElement.setAttribute("data-theme",e)}function ce(e){return e==="auto"?de():e}function le(){u.local.get(k,t=>{let n=t[k]||"auto";_(ce(n))}),u.local.onChanged.addListener(t=>{if(t[k]){let n=t[k].newValue||"auto";_(ce(n))}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{u.local.get(k,t=>{(t[k]||"auto")==="auto"&&_(de())})})}var qe="https://api.dropcal.ai",S="auth",ye=document.getElementById("view-auth"),x=document.getElementById("view-input"),Ee=document.getElementById("view-settings"),W=document.getElementById("popup-header"),m=document.getElementById("drop-zone"),Z=document.getElementById("drop-zone-content"),X=document.getElementById("drop-zone-success"),q=document.getElementById("drop-zone-error"),J=document.getElementById("feedback-actions"),Se=[ye,x,Ee];function ge(){m.classList.remove("processing","success","error"),Z.classList.remove("hidden"),X.classList.add("hidden"),q.classList.add("hidden"),J.classList.add("hidden")}function p(e){for(let t of Se)t.classList.add("hidden");W.classList.toggle("hidden",e==="auth"||e==="settings"),document.body.classList.toggle("view-locked",e==="input"||e==="processing"),e==="auth"?ye.classList.remove("hidden"):e==="input"?(x.classList.remove("hidden"),ge()):e==="processing"?(x.classList.remove("hidden"),ge(),m.classList.add("processing")):e==="settings"&&Ee.classList.remove("hidden"),S=e}var Je=document.getElementById("header-brand");Je.addEventListener("click",e=>{e.preventDefault(),s.tabs.create({url:"https://dropcal.ai"})});var et=document.getElementById("btn-settings");et.addEventListener("click",()=>{Q=S,p("settings"),T="main",R("main"),St()});var tt=document.getElementById("btn-signin");tt.addEventListener("click",()=>{s.runtime.sendMessage({type:"SIGN_IN"}),window.close()});var be=document.getElementById("btn-link"),Le=document.getElementById("btn-images"),ke=document.getElementById("btn-files"),Ie=document.getElementById("btn-center"),we=document.getElementById("btn-audio"),Ce=document.getElementById("btn-text"),xe=document.getElementById("btn-email"),nt=[be,Le,ke,Ie,we,Ce,xe],V=document.getElementById("results-section"),D=document.getElementById("results-list");for(let e of nt)e.addEventListener("click",t=>t.stopPropagation());function L(e){s.tabs.create({url:`https://dropcal.ai?input=${e}`}),window.close()}be.addEventListener("click",()=>L("link"));Le.addEventListener("click",()=>L("image"));ke.addEventListener("click",()=>L("document"));Ie.addEventListener("click",()=>L("upload"));we.addEventListener("click",()=>L("audio"));Ce.addEventListener("click",()=>L("text"));xe.addEventListener("click",()=>L("email"));m.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),m.classList.add("dragging")});m.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),m.classList.remove("dragging")});m.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),m.classList.remove("dragging");let t=e.dataTransfer;if(!t)return;if(t.files&&t.files.length>0){Oe(t.files);return}let n=t.getData("text/plain");n&&n.trim()&&_e(n.trim())});document.addEventListener("paste",e=>{if(S!=="input")return;let t=e.clipboardData;if(!t)return;if(t.files&&t.files.length>0){Oe(t.files);return}let n=t.getData("text/plain");n&&n.trim()&&_e(n.trim())});var ue={text:"ph-pencil-simple",image:"ph-images",page:"ph-globe",file:"ph-files"};function st(e){return e.icon?`ph-${e.icon}`:ue[e.inputType]||ue.text}var U=new Set,$=new Map;function ot(e,t,n=25){let o=0;e.textContent="",e.classList.add("typing-cursor");let a=setInterval(()=>{o<t.length?e.textContent=t.substring(0,++o):(clearInterval(a),e.classList.remove("typing-cursor"))},n)}function it(e){let n=Math.floor((new Date().getTime()-e)/(1e3*60*60*24));return n===0?"Today":n===1?"Yesterday":n<=7?"7 Days":n<=30?"30 Days":"Older"}function at(e){return e.filter(t=>t.status==="error"?!1:t.status==="polling"?!0:t.eventCount>0)}function rt(e=5){V.classList.remove("hidden"),D.innerHTML="";for(let t=0;t<e;t++){let n=document.createElement("div");n.className="skeleton-row",n.innerHTML='<div class="skeleton-icon"></div><div class="skeleton-title"></div>',D.appendChild(n)}}function Pe(e){let t=at(e);if(t.length===0){V.classList.add("hidden");return}V.classList.remove("hidden"),D.innerHTML="";let n=new Map,o=["Today","Yesterday","7 Days","30 Days","Older"];for(let a of t){let i=it(a.createdAt);n.has(i)||n.set(i,[]),n.get(i).push(a)}for(let a of o){let i=n.get(a);if(!i||i.length===0)continue;let r=document.createElement("div");r.className="session-group";let E=document.createElement("div");E.className="session-group-label",E.textContent=a,r.appendChild(E);for(let c of i){let h=document.createElement("div");h.className="session-row",h.addEventListener("click",()=>Fe(c.sessionId));let v=document.createElement("i");v.className=`session-icon ph ${st(c)}`;let l=document.createElement("div");if(l.className="session-row-title",c.status==="polling"&&!c.title?l.innerHTML='<div class="skeleton-title"></div>':c.title?$.get(c.sessionId)===null&&!U.has(c.sessionId)?(U.add(c.sessionId),ot(l,c.title)):l.textContent=c.title:l.textContent="Untitled",c.status==="polling"&&l.classList.add("processing"),h.appendChild(v),h.appendChild(l),c.status==="polling"){let g=document.createElement("div");g.className="processing-indicator",h.appendChild(g)}else if(c.eventCount>0){let g=document.createElement("div");g.className=`event-count-badge${c.addedToCalendar?"":" unsynced"}`,g.textContent=String(c.eventCount),h.appendChild(g)}r.appendChild(h)}D.appendChild(r)}for(let a of e)$.set(a.sessionId,a.title)}var pe=document.getElementById("feedback-icon"),ct=document.getElementById("feedback-title"),me=document.getElementById("feedback-subtitle"),H=document.getElementById("feedback-error-icon"),G=document.getElementById("feedback-error-title"),I=document.getElementById("feedback-error-subtitle"),ee=document.getElementById("btn-dismiss-success"),te=document.getElementById("btn-dismiss-error"),d=null,P=new Set,dt=24*60*60*1e3;function lt(e){return!(e.status!=="processed"&&e.status!=="error"||e.dismissedAt||P.has(e.sessionId)||Date.now()-e.createdAt>dt)}function z(e,t){for(let n=t.length-1;n>=0;n--){let o=e.find(a=>a.sessionId===t[n]);if(o&&lt(o))return o}return null}function gt(e){d=e.sessionId,e.icon?pe.className=`ph-duotone ph-${e.icon} feedback-icon feedback-icon-success`:pe.className="ph-duotone ph-check-fat feedback-icon feedback-icon-success";let t=e.eventCount;ct.textContent=t===1?"1 Event Scheduled":`${t} Events Scheduled`,me.textContent=e.title||"",me.classList.toggle("hidden",!e.title),m.classList.remove("processing","error"),m.classList.add("success"),Z.classList.add("hidden"),q.classList.add("hidden"),X.classList.remove("hidden"),ee.classList.remove("hidden"),te.classList.add("hidden"),J.classList.remove("hidden"),x.classList.remove("hidden"),W.classList.remove("hidden"),S="input"}function Te(){m.classList.remove("processing","success"),m.classList.add("error"),Z.classList.add("hidden"),X.classList.add("hidden"),q.classList.remove("hidden"),ee.classList.add("hidden"),te.classList.remove("hidden"),J.classList.remove("hidden"),x.classList.remove("hidden"),W.classList.remove("hidden"),S="input"}function M(e){d=null,H.className="ph-duotone ph-warning-circle feedback-icon feedback-icon-error",G.textContent=e,I.textContent="",I.classList.add("hidden"),Te()}function Me(e){d=e.sessionId,e.status==="processed"&&e.eventCount===0?(H.className="ph-duotone ph-calendar-blank feedback-icon feedback-icon-error",G.textContent="No Events Found",I.textContent=e.title||"No calendar events were detected."):(H.className="ph-duotone ph-warning-circle feedback-icon feedback-icon-error",G.textContent="Processing Failed",I.textContent=e.errorMessage||""),I.classList.toggle("hidden",!I.textContent),Te()}function K(e){e.status==="error"||e.eventCount===0?Me(e):gt(e)}m.addEventListener("click",async()=>{if(m.classList.contains("success")&&d){let e=d;d=null,P.add(e),await Fe(e),await new Promise(t=>{s.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:e},()=>t())}),window.close()}else m.classList.contains("error")&&d&&(P.add(d),s.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d}),d=null,p("input"),b())});ee.addEventListener("click",e=>{e.stopPropagation(),d&&(P.add(d),s.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d})),d=null,p("input"),b()});te.addEventListener("click",()=>{d&&(P.add(d),s.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d}),d=null),p("input"),b()});var T="main",w="MM/DD/YYYY",C="auto",j=[],fe="free",Q="input",ut=document.getElementById("settings-back-btn"),pt=document.getElementById("settings-user-email"),mt=document.getElementById("settings-main"),ft=document.getElementById("settings-integrations-view"),he=document.getElementById("settings-providers-list"),De=document.getElementById("settings-upgrade"),ht=document.getElementById("settings-date-format"),ve=document.getElementById("settings-date-icon"),vt=document.getElementById("settings-date-value"),yt=document.getElementById("settings-theme"),O=document.getElementById("settings-theme-icon"),F=document.getElementById("settings-theme-label"),Et=document.getElementById("settings-integrations-btn"),Re=document.getElementById("settings-logout"),Be=document.getElementById("settings-disconnect-btn"),Ae=document.getElementById("settings-disconnect-back");function R(e){T=e,mt.classList.toggle("hidden",e!=="main"),ft.classList.toggle("hidden",e==="main"),Re.classList.toggle("hidden",e!=="main"),Be.classList.toggle("hidden",e!=="integrations"),Ae.classList.toggle("hidden",e!=="disconnect")}function St(){s.runtime.sendMessage({type:"GET_USER_PROFILE"},e=>{if(e?.ok&&e.profile){let t=e.profile;pt.textContent=t.email||"",fe=t.plan==="pro"?"pro":"free",w=t.preferences?.date_format==="DD/MM/YYYY"?"DD/MM/YYYY":"MM/DD/YYYY",C=["auto","light","dark"].includes(t.preferences?.theme_mode)?t.preferences.theme_mode:"auto";let n=De.querySelector("span");n.textContent=fe==="pro"?"Manage subscription":"Upgrade plan",Ne(),Ye()}})}function Ne(){vt.textContent=w,w==="DD/MM/YYYY"?ve.className="ph ph-globe-simple settings-item-icon":ve.className="ph ph-football-helmet settings-item-icon"}function Ye(){C==="auto"?(O.className="ph ph-flashlight settings-item-icon",F.textContent="Auto theme"):C==="dark"?(O.className="ph ph-moon-stars settings-item-icon",F.textContent="Dark mode"):(O.className="ph ph-sun-horizon settings-item-icon",F.textContent="Light mode")}function bt(){s.runtime.sendMessage({type:"GET_CALENDAR_PROVIDERS"},e=>{e?.ok&&e.providers&&(j=e.providers,B())})}function B(){he.innerHTML="";let e=[{key:"google",name:"Google",iconClass:"ph ph-google-logo"},{key:"microsoft",name:"Outlook",iconClass:"ph ph-microsoft-outlook-logo"},{key:"apple",name:"Apple",iconClass:"ph ph-apple-logo"}];for(let t of e){let n=j.find(l=>l.provider===t.key),o=n?.connected??!1,a=n?.is_primary??!1,i=T==="disconnect",r=document.createElement("button");r.className="settings-item settings-integration-row",o&&a&&!i&&r.classList.add("settings-integration-active");let E=document.createElement("i");E.className=`${t.iconClass} settings-item-icon`;let c=document.createElement("div");c.className="settings-integration-info";let h=document.createElement("span");h.className="settings-integration-name",h.textContent=t.name;let v=document.createElement("span");if(v.className="settings-integration-detail",o?i?(v.textContent="Disconnect",v.style.color="var(--error)"):v.textContent=n?.email||"":(v.textContent=i?"Not connected":"Connect",i&&(r.style.opacity="0.4",r.style.cursor="default")),c.appendChild(h),c.appendChild(v),r.appendChild(E),r.appendChild(c),o){let l=document.createElement("div");if(l.className="settings-integration-actions",i){let g=document.createElement("i");g.className="ph ph-sign-out",g.style.color="var(--error)",l.appendChild(g)}else{let g=document.createElement("i");g.className=a?"ph ph-star settings-star-active":"ph ph-star settings-star-inactive",l.appendChild(g)}r.appendChild(l)}o&&i?r.addEventListener("click",()=>{s.runtime.sendMessage({type:"DISCONNECT_PROVIDER",provider:t.key},l=>{l?.ok&&bt()})}):o?r.addEventListener("click",()=>{s.runtime.sendMessage({type:"SET_PRIMARY_PROVIDER",provider:t.key},l=>{if(l?.ok){for(let g of j)g.is_primary=g.provider===t.key;B()}})}):i||r.addEventListener("click",()=>{s.tabs.create({url:"https://dropcal.ai"})}),he.appendChild(r)}}ut.addEventListener("click",()=>{T==="integrations"||T==="disconnect"?R("main"):(p(Q),Q==="input"&&b())});De.addEventListener("click",()=>{s.tabs.create({url:"https://dropcal.ai/plans"})});ht.addEventListener("click",()=>{w=w==="MM/DD/YYYY"?"DD/MM/YYYY":"MM/DD/YYYY",Ne(),s.runtime.sendMessage({type:"UPDATE_PREFERENCES",preferences:{date_format:w}})});yt.addEventListener("click",()=>{let e=["auto","light","dark"],t=e.indexOf(C);C=e[(t+1)%3],Ye(),s.runtime.sendMessage({type:"UPDATE_PREFERENCES",preferences:{theme_mode:C}})});Et.addEventListener("click",()=>{s.tabs.create({url:"https://dropcal.ai/?settings=integrations"}),window.close()});Re.addEventListener("click",()=>{s.runtime.sendMessage({type:"SIGN_OUT"},()=>{p("auth")})});Be.addEventListener("click",()=>{R("disconnect"),B()});Ae.addEventListener("click",()=>{R("integrations"),B()});function _e(e){p("processing"),s.runtime.sendMessage({type:"SUBMIT_TEXT",text:e},t=>{t&&!t.ok?M(t.error||"Failed to process text"):window.close()})}async function Oe(e){p("processing");let n=(await new Promise(o=>{u.local.get("auth",a=>o(a))})).auth?.accessToken;if(!n){M("Not authenticated. Please sign in.");return}for(let o of Array.from(e))try{let a=new FormData;a.append("file",o);let i=await fetch(`${qe}/upload`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:a});if(!i.ok){let E=await i.json().catch(()=>({error:"Upload failed"}));M(E.error||`Upload failed (${i.status})`);return}let{session:r}=await i.json();s.runtime.sendMessage({type:"TRACK_SESSION",sessionId:r.id,inputType:o.type.startsWith("image/")?"image":"file"})}catch{M("Failed to upload file");return}window.close()}async function Fe(e){await new Promise(n=>{u.session.set({sidebarSessionId:e},n)});let t=await s.windows.getCurrent();t.id&&await Y.open({windowId:t.id,sessionId:e})}function Lt(e,t){if(S==="processing"){let n=z(e,t);if(n){K(n);return}if(!e.some(o=>o.status==="polling")){let o=e[0];o&&(o.status==="error"||o.status==="processed"&&o.eventCount===0)?Me(o):p("input")}return}if(S==="input"){let n=z(e,t);n&&d!==n.sessionId&&K(n)}}function b(){u.local.get(["sessionHistory","notificationQueue"],e=>{let t=e.sessionHistory?.sessions||[],n=e.notificationQueue||[];Pe(t),Lt(t,n)})}u.local.onChanged.addListener(e=>{(e.sessionHistory||e.notificationQueue)&&b(),e.auth&&s.runtime.sendMessage({type:"GET_AUTH"},t=>{t?.isAuthenticated?(p("input"),b()):p("auth")})});u.session.onChanged.addListener(()=>{b()});le();s.runtime.sendMessage({type:"GET_AUTH"},e=>{if(!(e?.isAuthenticated??!1)){p("auth");return}p("input"),rt(),u.local.get(["sessionHistory","notificationQueue"],n=>{let o=n.sessionHistory?.sessions||[],a=n.notificationQueue||[];for(let i of o)$.set(i.sessionId,i.title),i.title&&U.add(i.sessionId);if(o.some(i=>i.status==="polling"))p("processing");else{let i=z(o,a);if(i){for(let r of Se)r.classList.add("hidden");K(i)}else p("input")}Pe(o)})});
//# sourceMappingURL=popup.js.map
