var d=globalThis.chrome,q=typeof browser<"u",s=q?browser:d,A=typeof d<"u"&&"sidePanel"in d,G=typeof browser<"u"&&typeof browser.sidebarAction?.open=="function",M=typeof d<"u"&&typeof d.storage<"u"&&"session"in d.storage,L=typeof d<"u"&&"notifications"in d,X=typeof d<"u"&&typeof d.action?.openPopup=="function",Q=typeof d<"u"&&"alarms"in d;var p="__session:";function R(e){return typeof e=="string"?[`${p}${e}`]:Array.isArray(e)?e.map(t=>`${p}${t}`):Object.keys(e).map(t=>`${p}${t}`)}function I(e){let t={};for(let[n,o]of Object.entries(e))t[`${p}${n}`]=o;return t}function Z(e){let t={};for(let[n,o]of Object.entries(e))n.startsWith(p)&&(t[n.slice(p.length)]=o);return t}var x=new Set,N=!1;function ee(){N||(N=!0,s.storage.local.onChanged.addListener(e=>{if(x.size===0)return;let t={},n=!1;for(let[o,m]of Object.entries(e))o.startsWith(p)&&(t[o.slice(p.length)]=m,n=!0);if(n)for(let o of x)o(t,"session")}))}var te={get(e,t){let n=e===null?null:R(e);s.storage.local.get(n,o=>{t(Z(o))})},set(e,t){t?s.storage.local.set(I(e),t):s.storage.local.set(I(e))},remove(e,t){let n=R(e);t?s.storage.local.remove(n,t):s.storage.local.remove(n)},clear(e){s.storage.local.get(null,t=>{let n=Object.keys(t).filter(o=>o.startsWith(p));n.length>0?e?s.storage.local.remove(n,e):s.storage.local.remove(n):e?.()})},onChanged:{addListener(e){ee(),x.add(e)}}};function ne(){let e=s.storage.session;return{get(t,n){e.get(t,n)},set(t,n){n?e.set(t,n):e.set(t)},remove(t,n){n?e.remove(t,n):e.remove(t)},clear(t){t?e.clear(t):e.clear()},onChanged:e.onChanged}}var i={local:s.storage.local,session:M?ne():te,onChanged:s.storage.onChanged};var oe={create(e,t){L&&s.notifications.create(e,t)},onClicked:L?s.notifications.onClicked:{addListener:e=>{}}};function se(){return{isSupported:!0,async open({windowId:e,sessionId:t}){t&&await new Promise(n=>{i.session.set({sidebarSessionId:t},n)}),e&&await s.sidePanel.open({windowId:e})}}}function re(){return{isSupported:!0,async open({sessionId:e}){await browser.sidebarAction.open(),e&&i.session.set({sidebarSessionId:e})}}}var ae=A?se():re();var Ae=1/30;var u="themeMode";function B(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function T(e){document.documentElement.setAttribute("data-theme",e)}function $(e){return e==="auto"?B():e}function D(){i.local.get(u,t=>{let n=t[u]||"auto";T($(n))}),i.local.onChanged.addListener(t=>{if(t[u]){let n=t[u].newValue||"auto";T($(n))}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{i.local.get(u,t=>{(t[u]||"auto")==="auto"&&T(B())})})}var z=document.getElementById("sidebar-title"),ie=document.getElementById("state-loading"),de=document.getElementById("state-events"),le=document.getElementById("state-error"),ce=document.getElementById("state-empty"),O=document.getElementById("skeleton-list"),P=document.getElementById("events-list"),w=document.getElementById("sidebar-error-message"),pe=document.getElementById("btn-back"),a=document.getElementById("btn-add-all"),ge=document.getElementById("btn-open-dropcal"),l=null;function g(e){ie.classList.toggle("hidden",e!=="loading"),de.classList.toggle("hidden",e!=="events"),le.classList.toggle("hidden",e!=="error"),ce.classList.toggle("hidden",e!=="empty")}function _(e){O.innerHTML="";for(let t=0;t<e;t++){let n=document.createElement("div");n.className="skeleton-card",n.style.opacity=String(1-t*.15),O.appendChild(n)}}function H(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function me(e,t){return e.date?"All day":e.dateTime&&t.dateTime?`${H(e.dateTime)} - ${H(t.dateTime)}`:""}function k(e){return e.start.date&&!e.start.dateTime?new Date(e.start.date+"T00:00:00"):new Date(e.start.dateTime||"")}function fe(e){let t=new Map,n=[...e].sort((o,m)=>k(o).getTime()-k(m).getTime());for(let o of n){let c=k(o).toDateString();t.has(c)||t.set(c,[]),t.get(c).push(o)}return t}var ue='<i class="ph-bold ph-map-pin" style="font-size: 16px"></i>',he='<i class="ph-bold ph-equals" style="font-size: 16px"></i>';function F(e){if(P.innerHTML="",e.length===0){g("empty");return}let t=fe(e),n="";t.forEach((o,m)=>{let c=new Date(m),S=c.toLocaleDateString("en-US",{month:"long",...c.getFullYear()!==new Date().getFullYear()&&{year:"numeric"}});if(S!==n){n=S;let r=document.createElement("div");r.className="month-header",r.innerHTML=`<h2 class="month-header-text">${S}</h2>`,P.appendChild(r)}let h=document.createElement("div");h.className="date-group";let K=new Date,j=c.toDateString()===K.toDateString(),V=c.toLocaleDateString("en-US",{weekday:"short"}),W=c.getDate(),b=document.createElement("div");b.className=`date-header${j?" today":""}`,b.innerHTML=`
      <div class="date-day-label">${V}</div>
      <div class="date-circle">
        <span class="date-number">${W}</span>
      </div>
    `;let C=document.createElement("div");C.className="date-events";for(let r of o){let f=document.createElement("div");f.className="event-card";let E=r.calendarColor||"#1170C5";f.style.borderLeftColor=E,f.style.backgroundColor=`${E}12`;let Y=me(r.start,r.end),v=`
        <div class="event-card-title-row">
          <span class="event-card-title">${y(r.summary)}</span>
          <span class="event-card-time">(${Y})</span>
        </div>
      `;r.location&&(v+=`
          <div class="event-card-meta">
            ${ue}
            <span>${y(r.location)}</span>
          </div>
        `),r.description&&(v+=`
          <div class="event-card-meta event-card-description">
            ${he}
            <span>${y(r.description)}</span>
          </div>
        `),r.calendarName&&(v+=`
          <div class="event-calendar-badge">
            <span class="calendar-badge-dot" style="background-color: ${E}"></span>
            <span class="calendar-badge-text">${y(r.calendarName)}</span>
          </div>
        `),f.innerHTML=v,f.addEventListener("click",()=>{l&&s.runtime.sendMessage({type:"OPEN_SESSION",sessionId:l})}),C.appendChild(f)}h.appendChild(b),h.appendChild(C),P.appendChild(h)}),g("events")}function y(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function U(e){l=e,_(3),g("loading"),i.local.get("sessionHistory",t=>{let o=t.sessionHistory?.sessions.find(m=>m.sessionId===e);if(!o){w.textContent="Session not found.",g("error");return}if(z.textContent=o.title||"Events",o.status==="error"){w.textContent=o.errorMessage||"Processing failed.",g("error");return}if(o.status==="polling"){_(3),g("loading");return}o.events&&o.events.length>0?F(o.events):g("empty"),ve(o.addedToCalendar)})}function ve(e){e?(a.classList.add("added"),a.innerHTML='<i class="ph ph-check-circle btn-icon" style="font-size: 18px"></i> Added to calendar'):(a.classList.remove("added"),a.innerHTML='<i class="ph-duotone ph-calendar-star btn-icon" style="font-size: 18px"></i> Add to Calendar')}pe.addEventListener("click",()=>{window.close()});a.addEventListener("click",()=>{if(!l||a.classList.contains("loading")||a.classList.contains("added"))return;let e=()=>{a.classList.remove("loading"),a.innerHTML='<i class="ph-duotone ph-calendar-star btn-icon" style="font-size: 18px"></i> Add to Calendar'};a.classList.add("loading"),a.innerHTML='<i class="ph ph-spinner btn-icon" style="font-size: 18px"></i> Adding...';try{s.runtime.sendMessage({type:"PUSH_ALL_EVENTS",sessionId:l},t=>{if(s.runtime.lastError){console.error("DropCal: sendMessage error",s.runtime.lastError),e();return}a.classList.remove("loading"),t?.ok?(a.classList.add("added"),a.innerHTML='<i class="ph ph-check-circle btn-icon" style="font-size: 18px"></i> Added to calendar'):e()})}catch(t){console.error("DropCal: sendMessage threw",t),e()}});ge.addEventListener("click",()=>{l&&(s.runtime.sendMessage({type:"OPEN_SESSION",sessionId:l}),window.close())});i.local.onChanged.addListener(e=>{if(e.sessionHistory&&l){let n=e.sessionHistory.newValue?.sessions.find(o=>o.sessionId===l);n&&(z.textContent=n.title||"Events",n.status==="processed"&&n.events&&n.events.length>0?F(n.events):n.status==="error"&&(w.textContent=n.errorMessage||"Processing failed.",g("error")))}});D();i.session.get("sidebarSessionId",e=>{let t=e.sidebarSessionId;t?U(t):g("empty")});i.session.onChanged.addListener(e=>{if(e.sidebarSessionId){let t=e.sidebarSessionId.newValue;t&&t!==l&&U(t)}});
//# sourceMappingURL=sidebar.js.map
