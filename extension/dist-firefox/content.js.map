{
  "version": 3,
  "sources": ["../content.ts"],
  "sourcesContent": ["// Content script that runs on dropcal.ai / www.dropcal.ai\n// Reads the Supabase session from localStorage and sends it to the extension\n//\n// Note: This is bundled as IIFE (not ES module), so compat/ is not importable.\n// Content scripts only use chrome.runtime.sendMessage which works identically\n// across all browsers (Firefox's chrome.* compat shim covers it).\n\ndeclare const browser: { runtime: typeof chrome.runtime } | undefined;\n\nconst runtime =\n  typeof browser !== 'undefined' ? browser.runtime : chrome.runtime;\n\nconst SUPABASE_STORAGE_KEY = 'sb-bdpiluwfhfmitvrcdrlr-auth-token';\nconst THEME_STORAGE_KEY = 'theme-mode';\n\nlet lastSentToken: string | null = null;\nlet lastSentTheme: string | null = null;\n\nfunction readAndSendToken(): void {\n  try {\n    const raw = localStorage.getItem(SUPABASE_STORAGE_KEY);\n    if (!raw) {\n      if (lastSentToken !== null) {\n        lastSentToken = null;\n        runtime.sendMessage({ type: 'AUTH_SIGNED_OUT' }).catch(() => {});\n      }\n      return;\n    }\n\n    const session = JSON.parse(raw);\n    const accessToken = session?.access_token;\n    const refreshToken = session?.refresh_token;\n    const expiresAt = session?.expires_at;\n\n    if (accessToken && refreshToken && expiresAt) {\n      // Only send if token changed (avoid spamming the background)\n      if (accessToken !== lastSentToken) {\n        lastSentToken = accessToken;\n        runtime.sendMessage({\n          type: 'AUTH_TOKEN',\n          accessToken,\n          refreshToken,\n          expiresAt,\n        }).catch(() => {});\n      }\n    } else if (lastSentToken !== null) {\n      lastSentToken = null;\n      runtime.sendMessage({ type: 'AUTH_SIGNED_OUT' }).catch(() => {});\n    }\n  } catch {\n    // localStorage read or sendMessage failed \u2014 ignore\n  }\n}\n\nfunction readAndSendTheme(): void {\n  try {\n    const theme = localStorage.getItem(THEME_STORAGE_KEY) || 'auto';\n    if (theme !== lastSentTheme) {\n      lastSentTheme = theme;\n      runtime.sendMessage({ type: 'THEME_CHANGED', themeMode: theme }).catch(() => {});\n    }\n  } catch {\n    // ignore\n  }\n}\n\n// Send token and theme on page load\nreadAndSendToken();\nreadAndSendTheme();\n\n// Rapid polling for the first 15 seconds to catch post-OAuth token writes\n// (Supabase processes the OAuth hash fragment async after page load)\nlet rapidPollCount = 0;\nconst rapidPoll = setInterval(() => {\n  readAndSendToken();\n  readAndSendTheme();\n  rapidPollCount++;\n  if (rapidPollCount >= 15) {\n    clearInterval(rapidPoll);\n  }\n}, 1000);\n\n// Watch for cross-tab localStorage changes\nwindow.addEventListener('storage', (event) => {\n  if (event.key === SUPABASE_STORAGE_KEY) {\n    readAndSendToken();\n  }\n  if (event.key === THEME_STORAGE_KEY) {\n    readAndSendTheme();\n  }\n});\n\n// Steady-state poll every 5s to catch same-tab token refreshes and theme changes\nsetInterval(() => {\n  readAndSendToken();\n  readAndSendTheme();\n}, 5000);\n"],
  "mappings": "mBASA,IAAMA,EACJ,OAAO,QAAY,IAAc,QAAQ,QAAU,OAAO,QAEtDC,EAAuB,qCACvBC,EAAoB,aAEtBC,EAA+B,KAC/BC,EAA+B,KAEnC,SAASC,GAAyB,CAChC,GAAI,CACF,IAAMC,EAAM,aAAa,QAAQL,CAAoB,EACrD,GAAI,CAACK,EAAK,CACJH,IAAkB,OACpBA,EAAgB,KAChBH,EAAQ,YAAY,CAAE,KAAM,iBAAkB,CAAC,EAAE,MAAM,IAAM,CAAC,CAAC,GAEjE,MACF,CAEA,IAAMO,EAAU,KAAK,MAAMD,CAAG,EACxBE,EAAcD,GAAS,aACvBE,EAAeF,GAAS,cACxBG,EAAYH,GAAS,WAEvBC,GAAeC,GAAgBC,EAE7BF,IAAgBL,IAClBA,EAAgBK,EAChBR,EAAQ,YAAY,CAClB,KAAM,aACN,YAAAQ,EACA,aAAAC,EACA,UAAAC,CACF,CAAC,EAAE,MAAM,IAAM,CAAC,CAAC,GAEVP,IAAkB,OAC3BA,EAAgB,KAChBH,EAAQ,YAAY,CAAE,KAAM,iBAAkB,CAAC,EAAE,MAAM,IAAM,CAAC,CAAC,EAEnE,MAAQ,CAER,CACF,CAEA,SAASW,GAAyB,CAChC,GAAI,CACF,IAAMC,EAAQ,aAAa,QAAQV,CAAiB,GAAK,OACrDU,IAAUR,IACZA,EAAgBQ,EAChBZ,EAAQ,YAAY,CAAE,KAAM,gBAAiB,UAAWY,CAAM,CAAC,EAAE,MAAM,IAAM,CAAC,CAAC,EAEnF,MAAQ,CAER,CACF,CAGAP,EAAiB,EACjBM,EAAiB,EAIjB,IAAIE,EAAiB,EACfC,EAAY,YAAY,IAAM,CAClCT,EAAiB,EACjBM,EAAiB,EACjBE,IACIA,GAAkB,IACpB,cAAcC,CAAS,CAE3B,EAAG,GAAI,EAGP,OAAO,iBAAiB,UAAYC,GAAU,CACxCA,EAAM,MAAQd,GAChBI,EAAiB,EAEfU,EAAM,MAAQb,GAChBS,EAAiB,CAErB,CAAC,EAGD,YAAY,IAAM,CAChBN,EAAiB,EACjBM,EAAiB,CACnB,EAAG,GAAI",
  "names": ["runtime", "SUPABASE_STORAGE_KEY", "THEME_STORAGE_KEY", "lastSentToken", "lastSentTheme", "readAndSendToken", "raw", "session", "accessToken", "refreshToken", "expiresAt", "readAndSendTheme", "theme", "rapidPollCount", "rapidPoll", "event"]
}
