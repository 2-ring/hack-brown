var i=globalThis.chrome,G=typeof browser<"u",s=G?browser:i,R=typeof i<"u"&&"sidePanel"in i,A=typeof browser<"u"&&"sidebarAction"in browser,I=typeof i<"u"&&typeof i.storage<"u"&&"session"in i.storage,E=typeof i<"u"&&"notifications"in i,X=typeof i<"u"&&typeof i.action?.openPopup=="function",Q=typeof i<"u"&&"alarms"in i;var c="__session:";function M(e){return typeof e=="string"?[`${c}${e}`]:Array.isArray(e)?e.map(t=>`${c}${t}`):Object.keys(e).map(t=>`${c}${t}`)}function $(e){let t={};for(let[n,o]of Object.entries(e))t[`${c}${n}`]=o;return t}function Z(e){let t={};for(let[n,o]of Object.entries(e))n.startsWith(c)&&(t[n.slice(c.length)]=o);return t}var P=new Set,N=!1;function ee(){N||(N=!0,s.storage.local.onChanged.addListener(e=>{if(P.size===0)return;let t={},n=!1;for(let[o,p]of Object.entries(e))o.startsWith(c)&&(t[o.slice(c.length)]=p,n=!0);if(n)for(let o of P)o(t,"session")}))}var te={get(e,t){let n=e===null?null:M(e);s.storage.local.get(n,o=>{t(Z(o))})},set(e,t){t?s.storage.local.set($(e),t):s.storage.local.set($(e))},remove(e,t){let n=M(e);t?s.storage.local.remove(n,t):s.storage.local.remove(n)},clear(e){s.storage.local.get(null,t=>{let n=Object.keys(t).filter(o=>o.startsWith(c));n.length>0?e?s.storage.local.remove(n,e):s.storage.local.remove(n):e?.()})},onChanged:{addListener(e){ee(),P.add(e)}}};function ne(){let e=s.storage.session;return{get(t,n){e.get(t,n)},set(t,n){n?e.set(t,n):e.set(t)},remove(t,n){n?e.remove(t,n):e.remove(t)},clear(t){t?e.clear(t):e.clear()},onChanged:e.onChanged}}var a={local:s.storage.local,session:I?ne():te,onChanged:s.storage.onChanged};var oe={create(e,t){E&&s.notifications.create(e,t)},onClicked:E?s.notifications.onClicked:{addListener:e=>{}}};function se(){return{isSupported:!0,async open({windowId:e,sessionId:t}){t&&await new Promise(n=>{a.session.set({sidebarSessionId:t},n)}),e&&await s.sidePanel.open({windowId:e})}}}function re(){return{isSupported:!0,async open({sessionId:e}){e&&await new Promise(t=>{a.session.set({sidebarSessionId:e},t)}),await s.sidebarAction.open()}}}function ae(){return{isSupported:!0,async open({sessionId:e}){let t=e?`?session=${e}`:"",n=s.runtime.getURL(`sidebar/sidebar.html${t}`);await s.windows.create({url:n,type:"popup",width:380,height:600})}}}var ie=R?se():A?re():ae();var Re=1/30;var f="themeMode";function B(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function x(e){document.documentElement.setAttribute("data-theme",e)}function O(e){return e==="auto"?B():e}function D(){a.local.get(f,t=>{let n=t[f]||"auto";x(O(n))}),a.local.onChanged.addListener(t=>{if(t[f]){let n=t[f].newValue||"auto";x(O(n))}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{a.local.get(f,t=>{(t[f]||"auto")==="auto"&&x(B())})})}var K=document.getElementById("sidebar-title"),de=document.getElementById("state-loading"),ce=document.getElementById("state-events"),le=document.getElementById("state-error"),pe=document.getElementById("state-empty"),_=document.getElementById("skeleton-list"),w=document.getElementById("events-list"),T=document.getElementById("sidebar-error-message"),ge=document.getElementById("btn-back"),me=document.getElementById("btn-open-dropcal"),g=null;function l(e){de.classList.toggle("hidden",e!=="loading"),ce.classList.toggle("hidden",e!=="events"),le.classList.toggle("hidden",e!=="error"),pe.classList.toggle("hidden",e!=="empty")}function H(e){_.innerHTML="";for(let t=0;t<e;t++){let n=document.createElement("div");n.className="skeleton-card",n.style.opacity=String(1-t*.15),_.appendChild(n)}}function F(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function fe(e,t){return e.date?"All day":e.dateTime&&t.dateTime?`${F(e.dateTime)} - ${F(t.dateTime)}`:""}function L(e){let t=e.start.dateTime||e.start.date||"";return new Date(t)}function ue(e){let t=new Map,n=[...e].sort((o,p)=>L(o).getTime()-L(p).getTime());for(let o of n){let d=L(o).toDateString();t.has(d)||t.set(d,[]),t.get(d).push(o)}return t}var he='<i class="ph-bold ph-map-pin" style="font-size: 16px"></i>',ve='<i class="ph-bold ph-equals" style="font-size: 16px"></i>';function j(e){if(w.innerHTML="",e.length===0){l("empty");return}let t=ue(e),n="";t.forEach((o,p)=>{let d=new Date(p),y=d.toLocaleDateString("en-US",{month:"long",...d.getFullYear()!==new Date().getFullYear()&&{year:"numeric"}});if(y!==n){n=y;let r=document.createElement("div");r.className="month-header",r.innerHTML=`<h2 class="month-header-text">${y}</h2>`,w.appendChild(r)}let u=document.createElement("div");u.className="date-group";let W=new Date,q=d.toDateString()===W.toDateString(),z=d.toLocaleDateString("en-US",{weekday:"short"}),V=d.getDate(),S=document.createElement("div");S.className=`date-header${q?" today":""}`,S.innerHTML=`
      <div class="date-day-label">${z}</div>
      <div class="date-circle">
        <span class="date-number">${V}</span>
      </div>
    `;let b=document.createElement("div");b.className="date-events";for(let r of o){let m=document.createElement("div");m.className="event-card";let C=r.calendarColor||"#1170C5";m.style.borderLeftColor=C,m.style.backgroundColor=`${C}12`;let Y=fe(r.start,r.end),h=`
        <div class="event-card-title-row">
          <span class="event-card-title">${v(r.summary)}</span>
          <span class="event-card-time">(${Y})</span>
        </div>
      `;r.location&&(h+=`
          <div class="event-card-meta">
            ${he}
            <span>${v(r.location)}</span>
          </div>
        `),r.description&&(h+=`
          <div class="event-card-meta event-card-description">
            ${ve}
            <span>${v(r.description)}</span>
          </div>
        `),r.calendarName&&(h+=`
          <div class="event-calendar-badge">
            <span class="calendar-badge-dot" style="background-color: ${C}"></span>
            <span class="calendar-badge-text">${v(r.calendarName)}</span>
          </div>
        `),m.innerHTML=h,m.addEventListener("click",()=>{g&&s.runtime.sendMessage({type:"OPEN_SESSION",sessionId:g})}),b.appendChild(m)}u.appendChild(S),u.appendChild(b),w.appendChild(u)}),l("events")}function v(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function k(e){g=e,H(3),l("loading"),a.local.get("sessionHistory",t=>{let o=t.sessionHistory?.sessions.find(p=>p.sessionId===e);if(!o){T.textContent="Session not found.",l("error");return}if(K.textContent=o.title||"Events",o.status==="error"){T.textContent=o.errorMessage||"Processing failed.",l("error");return}if(o.status==="polling"){H(3),l("loading");return}o.events&&o.events.length>0?j(o.events):l("empty")})}ge.addEventListener("click",()=>{window.close()});me.addEventListener("click",()=>{g&&s.runtime.sendMessage({type:"OPEN_SESSION",sessionId:g})});a.local.onChanged.addListener(e=>{if(e.sessionHistory&&g){let n=e.sessionHistory.newValue?.sessions.find(o=>o.sessionId===g);n&&(K.textContent=n.title||"Events",n.status==="processed"&&n.events&&n.events.length>0?j(n.events):n.status==="error"&&(T.textContent=n.errorMessage||"Processing failed.",l("error")))}});D();var ye=new URLSearchParams(window.location.search),U=ye.get("session");U?k(U):a.session.get("sidebarSessionId",e=>{let t=e.sidebarSessionId;t?k(t):l("empty")});a.session.onChanged.addListener(e=>{if(e.sidebarSessionId){let t=e.sidebarSessionId.newValue;t&&t!==g&&k(t)}});
//# sourceMappingURL=sidebar.js.map
