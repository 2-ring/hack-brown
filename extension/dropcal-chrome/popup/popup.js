var f=globalThis.chrome,Ve=typeof browser<"u",o=Ve?browser:f,se=typeof f<"u"&&"sidePanel"in f,A=typeof browser<"u"&&typeof browser.sidebarAction?.open=="function",oe=typeof f<"u"&&typeof f.storage<"u"&&"session"in f.storage,N=typeof f<"u"&&"notifications"in f,Ue=typeof f<"u"&&typeof f.action?.openPopup=="function",$e=typeof f<"u"&&"alarms"in f;var y="__session:";function ie(e){return typeof e=="string"?[`${y}${e}`]:Array.isArray(e)?e.map(t=>`${y}${t}`):Object.keys(e).map(t=>`${y}${t}`)}function re(e){let t={};for(let[n,s]of Object.entries(e))t[`${y}${n}`]=s;return t}function Ge(e){let t={};for(let[n,s]of Object.entries(e))n.startsWith(y)&&(t[n.slice(y.length)]=s);return t}var Y=new Set,ae=!1;function ze(){ae||(ae=!0,o.storage.local.onChanged.addListener(e=>{if(Y.size===0)return;let t={},n=!1;for(let[s,r]of Object.entries(e))s.startsWith(y)&&(t[s.slice(y.length)]=r,n=!0);if(n)for(let s of Y)s(t,"session")}))}var Ke={get(e,t){let n=e===null?null:ie(e);o.storage.local.get(n,s=>{t(Ge(s))})},set(e,t){t?o.storage.local.set(re(e),t):o.storage.local.set(re(e))},remove(e,t){let n=ie(e);t?o.storage.local.remove(n,t):o.storage.local.remove(n)},clear(e){o.storage.local.get(null,t=>{let n=Object.keys(t).filter(s=>s.startsWith(y));n.length>0?e?o.storage.local.remove(n,e):o.storage.local.remove(n):e?.()})},onChanged:{addListener(e){ze(),Y.add(e)}}};function je(){let e=o.storage.session;return{get(t,n){e.get(t,n)},set(t,n){n?e.set(t,n):e.set(t)},remove(t,n){n?e.remove(t,n):e.remove(t)},clear(t){t?e.clear(t):e.clear()},onChanged:e.onChanged}}var u={local:o.storage.local,session:oe?je():Ke,onChanged:o.storage.onChanged};var Qe={create(e,t){N&&o.notifications.create(e,t)},onClicked:N?o.notifications.onClicked:{addListener:e=>{}}};function Ze(){return{isSupported:!0,async open({windowId:e,sessionId:t}){t&&await new Promise(n=>{u.session.set({sidebarSessionId:t},n)}),e&&await o.sidePanel.open({windowId:e})}}}function We(){return{isSupported:!0,async open({sessionId:e}){await browser.sidebarAction.open(),e&&u.session.set({sidebarSessionId:e})}}}var _=se?Ze():We();var At=1/30;var k="themeMode";function de(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function O(e){document.documentElement.setAttribute("data-theme",e)}function ce(e){return e==="auto"?de():e}function le(){u.local.get(k,t=>{let n=t[k]||"auto";O(ce(n))}),u.local.onChanged.addListener(t=>{if(t[k]){let n=t[k].newValue||"auto";O(ce(n))}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{u.local.get(k,t=>{(t[k]||"auto")==="auto"&&O(de())})})}var Xe="https://api.dropcal.ai",S="auth",ye=document.getElementById("view-auth"),x=document.getElementById("view-input"),Ee=document.getElementById("view-settings"),W=document.getElementById("popup-header"),m=document.getElementById("drop-zone"),X=document.getElementById("drop-zone-content"),q=document.getElementById("drop-zone-success"),J=document.getElementById("drop-zone-error"),ee=document.getElementById("feedback-actions"),Se=[ye,x,Ee];function ge(){m.classList.remove("processing","success","error"),X.classList.remove("hidden"),q.classList.add("hidden"),J.classList.add("hidden"),ee.classList.add("hidden")}function p(e){for(let t of Se)t.classList.add("hidden");W.classList.toggle("hidden",e==="auth"||e==="settings"),e==="auth"?ye.classList.remove("hidden"):e==="input"?(x.classList.remove("hidden"),ge()):e==="processing"?(x.classList.remove("hidden"),ge(),m.classList.add("processing")):e==="settings"&&Ee.classList.remove("hidden"),S=e}var qe=document.getElementById("header-brand");qe.addEventListener("click",e=>{e.preventDefault(),o.tabs.create({url:"https://dropcal.ai"})});var Je=document.getElementById("btn-settings");Je.addEventListener("click",()=>{Z=S,p("settings"),T="main",R("main"),Et()});var et=document.getElementById("btn-signin");et.addEventListener("click",()=>{o.runtime.sendMessage({type:"SIGN_IN"}),window.close()});var be=document.getElementById("btn-link"),Le=document.getElementById("btn-images"),ke=document.getElementById("btn-files"),Ie=document.getElementById("btn-center"),Ce=document.getElementById("btn-audio"),we=document.getElementById("btn-text"),xe=document.getElementById("btn-email"),tt=[be,Le,ke,Ie,Ce,we,xe],U=document.getElementById("results-section"),D=document.getElementById("results-list");for(let e of tt)e.addEventListener("click",t=>t.stopPropagation());function L(e){o.tabs.create({url:`https://dropcal.ai?input=${e}`}),window.close()}be.addEventListener("click",()=>L("link"));Le.addEventListener("click",()=>L("image"));ke.addEventListener("click",()=>L("document"));Ie.addEventListener("click",()=>L("upload"));Ce.addEventListener("click",()=>L("audio"));we.addEventListener("click",()=>L("text"));xe.addEventListener("click",()=>L("email"));m.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),m.classList.add("dragging")});m.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),m.classList.remove("dragging")});m.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),m.classList.remove("dragging");let t=e.dataTransfer;if(!t)return;if(t.files&&t.files.length>0){Oe(t.files);return}let n=t.getData("text/plain");n&&n.trim()&&_e(n.trim())});document.addEventListener("paste",e=>{if(S!=="input")return;let t=e.clipboardData;if(!t)return;if(t.files&&t.files.length>0){Oe(t.files);return}let n=t.getData("text/plain");n&&n.trim()&&_e(n.trim())});var ue={text:"ph-pencil-simple",image:"ph-images",page:"ph-globe",file:"ph-files"};function nt(e){return e.icon?`ph-${e.icon}`:ue[e.inputType]||ue.text}var $=new Set,H=new Map;function st(e,t,n=25){let s=0;e.textContent="",e.classList.add("typing-cursor");let r=setInterval(()=>{s<t.length?e.textContent=t.substring(0,++s):(clearInterval(r),e.classList.remove("typing-cursor"))},n)}function ot(e){let n=Math.floor((new Date().getTime()-e)/(1e3*60*60*24));return n===0?"Today":n===1?"Yesterday":n<=7?"7 Days":n<=30?"30 Days":"Older"}function it(e){return e.filter(t=>t.status==="error"?!1:t.status==="polling"?!0:t.eventCount>0)}function rt(e=5){U.classList.remove("hidden"),D.innerHTML="";for(let t=0;t<e;t++){let n=document.createElement("div");n.className="skeleton-row",n.innerHTML='<div class="skeleton-icon"></div><div class="skeleton-title"></div>',D.appendChild(n)}}function Pe(e){let t=it(e);if(t.length===0){U.classList.add("hidden");return}U.classList.remove("hidden"),D.innerHTML="";let n=new Map,s=["Today","Yesterday","7 Days","30 Days","Older"];for(let r of t){let i=ot(r.createdAt);n.has(i)||n.set(i,[]),n.get(i).push(r)}for(let r of s){let i=n.get(r);if(!i||i.length===0)continue;let a=document.createElement("div");a.className="session-group";let E=document.createElement("div");E.className="session-group-label",E.textContent=r,a.appendChild(E);for(let c of i){let h=document.createElement("div");h.className="session-row",h.addEventListener("click",()=>Fe(c.sessionId));let v=document.createElement("i");v.className=`session-icon ph ${nt(c)}`;let l=document.createElement("div");if(l.className="session-row-title",c.status==="polling"&&!c.title?l.innerHTML='<div class="skeleton-title"></div>':c.title?H.get(c.sessionId)===null&&!$.has(c.sessionId)?($.add(c.sessionId),st(l,c.title)):l.textContent=c.title:l.textContent="Untitled",c.status==="polling"&&l.classList.add("processing"),h.appendChild(v),h.appendChild(l),c.status==="polling"){let g=document.createElement("div");g.className="processing-indicator",h.appendChild(g)}else if(c.eventCount>0){let g=document.createElement("div");g.className=`event-count-badge${c.addedToCalendar?"":" unsynced"}`,g.textContent=String(c.eventCount),h.appendChild(g)}a.appendChild(h)}D.appendChild(a)}for(let r of e)H.set(r.sessionId,r.title)}var pe=document.getElementById("feedback-icon"),at=document.getElementById("feedback-title"),me=document.getElementById("feedback-subtitle"),G=document.getElementById("feedback-error-icon"),z=document.getElementById("feedback-error-title"),I=document.getElementById("feedback-error-subtitle"),te=document.getElementById("btn-dismiss-success"),ne=document.getElementById("btn-dismiss-error"),d=null,P=new Set,ct=24*60*60*1e3;function dt(e){return!(e.status!=="processed"&&e.status!=="error"||e.dismissedAt||P.has(e.sessionId)||Date.now()-e.createdAt>ct)}function K(e,t){for(let n=t.length-1;n>=0;n--){let s=e.find(r=>r.sessionId===t[n]);if(s&&dt(s))return s}return null}function lt(e){d=e.sessionId,e.icon?pe.className=`ph-duotone ph-${e.icon} feedback-icon feedback-icon-success`:pe.className="ph-duotone ph-check-fat feedback-icon feedback-icon-success";let t=e.eventCount;at.textContent=t===1?"1 Event Scheduled":`${t} Events Scheduled`,me.textContent=e.title||"",me.classList.toggle("hidden",!e.title),m.classList.remove("processing","error"),m.classList.add("success"),X.classList.add("hidden"),J.classList.add("hidden"),q.classList.remove("hidden"),te.classList.remove("hidden"),ne.classList.add("hidden"),ee.classList.remove("hidden"),x.classList.remove("hidden"),W.classList.remove("hidden"),S="input"}function Te(){m.classList.remove("processing","success"),m.classList.add("error"),X.classList.add("hidden"),q.classList.add("hidden"),J.classList.remove("hidden"),te.classList.add("hidden"),ne.classList.remove("hidden"),ee.classList.remove("hidden"),x.classList.remove("hidden"),W.classList.remove("hidden"),S="input"}function M(e){d=null,G.className="ph-duotone ph-warning-circle feedback-icon feedback-icon-error",z.textContent=e,I.textContent="",I.classList.add("hidden"),Te()}function Me(e){d=e.sessionId,e.status==="processed"&&e.eventCount===0?(G.className="ph-duotone ph-calendar-blank feedback-icon feedback-icon-error",z.textContent="No Events Found",I.textContent=e.title||"No calendar events were detected."):(G.className="ph-duotone ph-warning-circle feedback-icon feedback-icon-error",z.textContent="Processing Failed",I.textContent=e.errorMessage||""),I.classList.toggle("hidden",!I.textContent),Te()}function j(e){e.status==="error"||e.eventCount===0?Me(e):lt(e)}m.addEventListener("click",async()=>{if(m.classList.contains("success")&&d){let e=d;d=null,P.add(e),await Fe(e),await new Promise(t=>{o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:e},()=>t())}),window.close()}else m.classList.contains("error")&&d&&(P.add(d),o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d}),d=null,p("input"),b())});te.addEventListener("click",e=>{e.stopPropagation(),d&&(P.add(d),o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d})),d=null,p("input"),b()});ne.addEventListener("click",()=>{d&&(P.add(d),o.runtime.sendMessage({type:"DISMISS_SESSION",sessionId:d}),d=null),p("input"),b()});var T="main",C="MM/DD/YYYY",w="auto",Q=[],fe="free",Z="input",gt=document.getElementById("settings-back-btn"),ut=document.getElementById("settings-user-email"),pt=document.getElementById("settings-main"),mt=document.getElementById("settings-integrations-view"),he=document.getElementById("settings-providers-list"),De=document.getElementById("settings-upgrade"),ft=document.getElementById("settings-date-format"),ve=document.getElementById("settings-date-icon"),ht=document.getElementById("settings-date-value"),vt=document.getElementById("settings-theme"),F=document.getElementById("settings-theme-icon"),V=document.getElementById("settings-theme-label"),yt=document.getElementById("settings-integrations-btn"),Re=document.getElementById("settings-logout"),Be=document.getElementById("settings-disconnect-btn"),Ae=document.getElementById("settings-disconnect-back");function R(e){T=e,pt.classList.toggle("hidden",e!=="main"),mt.classList.toggle("hidden",e==="main"),Re.classList.toggle("hidden",e!=="main"),Be.classList.toggle("hidden",e!=="integrations"),Ae.classList.toggle("hidden",e!=="disconnect")}function Et(){o.runtime.sendMessage({type:"GET_USER_PROFILE"},e=>{if(e?.ok&&e.profile){let t=e.profile;ut.textContent=t.email||"",fe=t.plan==="pro"?"pro":"free",C=t.preferences?.date_format==="DD/MM/YYYY"?"DD/MM/YYYY":"MM/DD/YYYY",w=["auto","light","dark"].includes(t.preferences?.theme_mode)?t.preferences.theme_mode:"auto";let n=De.querySelector("span");n.textContent=fe==="pro"?"Manage subscription":"Upgrade plan",Ne(),Ye()}})}function Ne(){ht.textContent=C,C==="DD/MM/YYYY"?ve.className="ph ph-globe-simple settings-item-icon":ve.className="ph ph-football-helmet settings-item-icon"}function Ye(){w==="auto"?(F.className="ph ph-flashlight settings-item-icon",V.textContent="Auto theme"):w==="dark"?(F.className="ph ph-moon-stars settings-item-icon",V.textContent="Dark mode"):(F.className="ph ph-sun-horizon settings-item-icon",V.textContent="Light mode")}function St(){o.runtime.sendMessage({type:"GET_CALENDAR_PROVIDERS"},e=>{e?.ok&&e.providers&&(Q=e.providers,B())})}function B(){he.innerHTML="";let e=[{key:"google",name:"Google",iconClass:"ph ph-google-logo"},{key:"microsoft",name:"Outlook",iconClass:"ph ph-microsoft-outlook-logo"},{key:"apple",name:"Apple",iconClass:"ph ph-apple-logo"}];for(let t of e){let n=Q.find(l=>l.provider===t.key),s=n?.connected??!1,r=n?.is_primary??!1,i=T==="disconnect",a=document.createElement("button");a.className="settings-item settings-integration-row",s&&r&&!i&&a.classList.add("settings-integration-active");let E=document.createElement("i");E.className=`${t.iconClass} settings-item-icon`;let c=document.createElement("div");c.className="settings-integration-info";let h=document.createElement("span");h.className="settings-integration-name",h.textContent=t.name;let v=document.createElement("span");if(v.className="settings-integration-detail",s?i?(v.textContent="Disconnect",v.style.color="var(--error)"):v.textContent=n?.email||"":(v.textContent=i?"Not connected":"Connect",i&&(a.style.opacity="0.4",a.style.cursor="default")),c.appendChild(h),c.appendChild(v),a.appendChild(E),a.appendChild(c),s){let l=document.createElement("div");if(l.className="settings-integration-actions",i){let g=document.createElement("i");g.className="ph ph-sign-out",g.style.color="var(--error)",l.appendChild(g)}else{let g=document.createElement("i");g.className=r?"ph ph-star settings-star-active":"ph ph-star settings-star-inactive",l.appendChild(g)}a.appendChild(l)}s&&i?a.addEventListener("click",()=>{o.runtime.sendMessage({type:"DISCONNECT_PROVIDER",provider:t.key},l=>{l?.ok&&St()})}):s?a.addEventListener("click",()=>{o.runtime.sendMessage({type:"SET_PRIMARY_PROVIDER",provider:t.key},l=>{if(l?.ok){for(let g of Q)g.is_primary=g.provider===t.key;B()}})}):i||a.addEventListener("click",()=>{o.tabs.create({url:"https://dropcal.ai"})}),he.appendChild(a)}}gt.addEventListener("click",()=>{T==="integrations"||T==="disconnect"?R("main"):(p(Z),Z==="input"&&b())});De.addEventListener("click",()=>{o.tabs.create({url:"https://dropcal.ai/plans"})});ft.addEventListener("click",()=>{C=C==="MM/DD/YYYY"?"DD/MM/YYYY":"MM/DD/YYYY",Ne(),o.runtime.sendMessage({type:"UPDATE_PREFERENCES",preferences:{date_format:C}})});vt.addEventListener("click",()=>{let e=["auto","light","dark"],t=e.indexOf(w);w=e[(t+1)%3],Ye(),o.runtime.sendMessage({type:"UPDATE_PREFERENCES",preferences:{theme_mode:w}})});yt.addEventListener("click",()=>{o.tabs.create({url:"https://dropcal.ai/?settings=integrations"}),window.close()});Re.addEventListener("click",()=>{o.runtime.sendMessage({type:"SIGN_OUT"},()=>{p("auth")})});Be.addEventListener("click",()=>{R("disconnect"),B()});Ae.addEventListener("click",()=>{R("integrations"),B()});function _e(e){p("processing"),o.runtime.sendMessage({type:"SUBMIT_TEXT",text:e},t=>{t&&!t.ok?M(t.error||"Failed to process text"):window.close()})}async function Oe(e){p("processing");let n=(await new Promise(s=>{u.local.get("auth",r=>s(r))})).auth?.accessToken;if(!n){M("Not authenticated. Please sign in.");return}for(let s of Array.from(e))try{let r=new FormData;r.append("file",s);let i=await fetch(`${Xe}/upload`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:r});if(!i.ok){let E=await i.json().catch(()=>({error:"Upload failed"}));M(E.error||`Upload failed (${i.status})`);return}let{session:a}=await i.json();o.runtime.sendMessage({type:"TRACK_SESSION",sessionId:a.id,inputType:s.type.startsWith("image/")?"image":"file"})}catch{M("Failed to upload file");return}window.close()}async function Fe(e){if(A){browser.sidebarAction.open(),u.session.set({sidebarSessionId:e});return}await new Promise(n=>{u.session.set({sidebarSessionId:e},n)});let t=await o.windows.getCurrent();t.id&&await _.open({windowId:t.id,sessionId:e})}function bt(e,t){if(S==="processing"){let n=K(e,t);if(n){j(n);return}if(!e.some(s=>s.status==="polling")){let s=e[0];s&&(s.status==="error"||s.status==="processed"&&s.eventCount===0)?Me(s):p("input")}return}if(S==="input"){let n=K(e,t);n&&d!==n.sessionId&&j(n)}}function b(){u.local.get(["sessionHistory","notificationQueue"],e=>{let t=e.sessionHistory?.sessions||[],n=e.notificationQueue||[];Pe(t),bt(t,n)})}u.local.onChanged.addListener(e=>{(e.sessionHistory||e.notificationQueue)&&b(),e.auth&&o.runtime.sendMessage({type:"GET_AUTH"},t=>{t?.isAuthenticated?(p("input"),b()):p("auth")})});u.session.onChanged.addListener(()=>{b()});le();o.runtime.sendMessage({type:"GET_AUTH"},e=>{if(!(e?.isAuthenticated??!1)){p("auth");return}p("input"),rt(),u.local.get(["sessionHistory","notificationQueue"],n=>{let s=n.sessionHistory?.sessions||[],r=n.notificationQueue||[];for(let i of s)H.set(i.sessionId,i.title),i.title&&$.add(i.sessionId);if(s.some(i=>i.status==="polling"))p("processing");else{let i=K(s,r);if(i){for(let a of Se)a.classList.add("hidden");j(i)}else p("input")}Pe(s)})});
//# sourceMappingURL=popup.js.map
