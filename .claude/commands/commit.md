---
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(git log:*), Bash(git commit:*), Bash(git reset HEAD:*), Bash(git ls-files:*)
description: Analyze staged changes and commit with a descriptive paragraph
---

## Context

- Staged files with sizes: !`git diff --cached --stat`
- Staged changes: !`git diff --cached`
- Current branch: !`git branch --show-current`
- Recent commits for style reference: !`git log --oneline -5`

## Your task

Based on the staged diff above, create a git commit. Follow these rules exactly:

### 1. Skip large files

Before committing, check the staged file list above. Any staged file **over 100KB** (102400 bytes) should be unstaged with `git reset HEAD <file>` and reported to the user. Common examples: JSON data dumps, trace files, build artifacts, large binaries. Do this before analyzing the diff.

**Important:** Never `git add` or `git reset` anything beyond this large-file safety check. Only commit what the user has already staged — do not modify the staging area for any other reason.

### 2. Sanity check

Review the staged diff for genuine issues. Keep in mind these changes may be a work in progress, partial, or spread across multiple commits, so **do not flag**:
- Missing files, incomplete features, or TODOs — that's normal for WIP
- Style preferences, naming opinions, or missing docs/tests
- Things that are simply unfamiliar to you

**Do flag** (and **do not commit**) if you find:
- Security issues: hardcoded secrets, SQL injection, XSS, auth bypasses, exposed credentials
- Bugs: obvious logic errors, off-by-ones, null derefs, race conditions, broken control flow
- Data loss risks: destructive operations without confirmation, dropped columns, missing backups
- Silent failures: swallowed exceptions hiding real errors, error paths that lose data

If any of the above are found, report them concisely (1-2 sentences each) and **stop without committing**. Otherwise, proceed to step 3.

### 3. Commit

1. **Write a commit message** that is a short paragraph (2-4 sentences) describing the changes at a high level. Focus on the "why" and the overall effect, not a line-by-line summary. Use plain, natural language.
2. **Do NOT** include any "Co-Authored-By" lines, "Generated by" attributions, or any mention of Claude, AI, or automated tools in the commit message.
3. **If there are no staged changes** (either originally or after unstaging large files), inform the user and do not commit.
4. Use a HEREDOC to pass the commit message to `git commit`.

Commit the changes using a single message. If any large files were skipped in step 1, mention which ones.
